---

- hosts: all
  tasks:
    - group_by: key=user_{{ ansible_user_id }}
      changed_when: False

# root user, create ansible user and install ansible-pull cronjob.
- hosts: user_root
  gather_facts: no
  sudo: no
  roles:
    - install_ansible_pull

# Non-root, use sudo to create or maintain ansible user & cronjob.
- hosts: '!user_root'
  gather_facts: no
  sudo: yes
  roles:
    - install_ansible_pull

