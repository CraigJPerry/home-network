---

# Provision a vanilla VM with all requirements for running the
# playbook test cases under tests/ dir.

- hosts: vagrant
  sudo: yes

  roles:

    - ansible

  tasks:

    - name: Add vm name alias to loopback
      # dnsdomainname delays ansible gather_facts without this
      lineinfile: state="present" dest="/etc/hosts" regexp="^127.0.0.1" line="127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 vagrant-fedora-19 vagrant-fedora-19.vagrantup.com"

    - name: Update MOTD with tests message
      lineinfile: state="present" dest="/etc/motd" regexp="^To run all tests" line="To run all tests:"

    - name: Update MOTD with cd command
      lineinfile: state="present" dest="/etc/motd" regexp="^    . cd" line="    $ cd /home-network"

    - name: Update MOTD with test command
      lineinfile: state="present" dest="/etc/motd" regexp="^    . sudo" line="    $ sudo python -m unittest discover && python -m unittest discover"

